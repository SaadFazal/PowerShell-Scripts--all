####################################################################################   Get the PST size + 20 GIG and compare with the available space in the C Drive####################################################################################$Path = 'C:\intune\PST'
if (!(Test-Path -Path $Path))
{
New-Item -ItemType "directory" -Path $Path
}
Get-ChildItem C:\ -Recurse -ErrorAction silentlycontinue -Filter '*.pst' | select fullname, @{label='size';Expression={$_.length/1MB}} | export-csv $path\Pstsize.csv -NoType$files = Import-CSV $path\Pstsize.csv$TotalPSTSize = 0foreach ($File in $Files.size){$TotalPstSize += ($file | Measure-Object -Sum).sum}$TotalPstSize$diskspace = @()#$diskspace = get-WmiObject win32_logicaldisk | select freeSpace$diskspace = get-WmiObject win32_logicaldisk | Where-Object {$_.DeviceId -eq 'C:'} | select freeSpace#$CDriveFreeSpace =$diskspace[0]$CDriveFreeSpace = $diskspace.freeSpace$CDriveFreeSpace = $CDriveFreeSpace /1mb#$FreeDiskSpace = Get-CimInstance -ClassName Win32_LogicalDisk | Select-Object -Property DeviceID,@{'Name' = 'FreeSpace (MB)'; Expression= { [int]($_.FreeSpace / 1MB) }} | Measure-Object -Property 'FreeSpace (GB)' -Sum#$FreeDiskSpace = Get-CimInstance -ClassName Win32_LogicalDisk | Select-Object -Property DeviceID,@{'Name' = 'FreeSpace (MB)'; Expression= { [int]($_.FreeSpace / 1MB) }} | Measure-Object -Property 'FreeSpace (MB)' -Sum#$TotalFreeDiskSpace = $FreeDiskSpace.SumIf ( $CDriveFreeSpace -ge $TotalPSTSize+20000){write-host "Enough space available" -ForegroundColor Green}else{Write-Error "Not enough space available"}